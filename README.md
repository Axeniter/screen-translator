# Screen Translator - переводчик экрана
## Описание
Screen Translator - это утилита для перевода выделенной области на экране.
## Установка
Вы можете либо собрать приложение сами, либо скачать готовый архив с собранным приложением.
### Сборка приложения
Требования:
- Windows 10+
- .NET 9.0+
- Visual Studio 2022+

Установка:
```bash
git clone https://github.com/Axeniter/screen-translator.git
```

Сборка:
- Открыть решение src/Translator.sln в Visual Studio
- Запустить сборку
### Готовое приложение
Чтобы скачать последнюю версию приложения, перейдите во вкладку Releases: https://github.com/Axeniter/screen-translator/releases и скачайте WindowsBuild.rar. После распаковки в папке будет exe файл для запуска.
## Как пользоваться
### Настройки
Главное окно приложения - это настройки. Необходимо установить:
- Исходный язык текста. Язык для распознавания OCR сервисом. Если выбранный язык не установлен, программа предложит установить его.
- Целевой язык. Язык на который нужно перевести.
- Горячая клавиша/сочетание клавиш для использования приложения.
### Использование
- Выставьте нужные настройки и сверните приложение.
- Нажмите установленную горячую клавишу.
- Выделите мышкой нужную область для перевода.
- Через некоторое время откроется окно с переведенным текстом.
## Документация
### Структура проекта
```
Translator/
├──Assets/           # Ресурсы проекта
├──Model/            # Модели проекта
├──Service/          # Сервисы распознавания и перевода
├──View/             # Окна приложения
├──ViewModel/        # Модель вида для окон
├──App.xaml          # Главный класс приложения
└──AssemblyInfo.cs
```
### Model/
#### DpiHelper.cs
Статический класс хелпер для получения информация о DPI окна для правильного захвата областей экрана.

Методы:
- `GetDpi(IntPtr hwnd)` - получает значения DPI для конкретного окна.
#### GlobalHotkey.cs
Класс для создания и регистрации глобального хоткея, работающего во всей системе независимо от того, в фокусе ли приложение.

Конструктор:
- `GlobalHotKey(ModifierKeys modifiers, Key key, Window window)` - создает сочетание клавиш из модификаторов (ctrl, shift, alt, windows) и клавиши, привязывая его к конкретному окну. Также сразу регистрирует его в системе.

События:
- `Pressed` - событие, вызываемое при нажатии установленного сочетания клавиш.
### Service/
#### LanguageService.cs
Статический класс для сопоставления человеко-читаемых названий языков с их языковыми кодами для Tesseract OCR и Google Translate.

Методы:
- `IsOcrLanguageSupported(string language)` - проверяет поддерживает ли OCR данный язык.
- `GetOcrLanguageCode(string language)` - получает код языка для Tesseract OCR.
- `IsTranslationLanguageSupported(string language)` - проверяет поддерживает ли перевод данный язык.
- `GetTranslationLanguageCode(string language)` - получает код языка для Google Translate.
- `GetAllOcrLanguages` - получает все названия языков поддерживающих OCR.
- `GetAllTranslationLanguages()` - получает все названия языков поддерживающих перевод.
#### OcrLanguageManager.cs
Класс, управляющий установкой, удалением и проверкой пакетов для распознавания языков.

Конструктор:
- `OcrLanguageManager()` - создает экземпляр сервиса и проверяет существование директории для хранения данных распознавания.

Методы:
- `InstallLanguageAsync(string language, CancellationToken cancellationToken)` - асинхронный метод, скачивающий данные для распознавания конкретного языка с официального GitHub репозитория Tesseract.
- `IsLanguageInstalled(string language)` - проверяет установлен ли нужный пакет для распознавания языка.
- `DeleteLanguage(string language)` - удаляет пакет для нужного языка, если он существует.
- `GetAllInstalledLanguages()` - получает список всех языков, для которых установлены пакеты для распознавания.
#### OcrService.cs
Сервис для работы с OCR.

Конструктор:
- `OcrService()` - создает экземпляр сервиса. Проверяет наличие директории с данными для распознавания.

Методы:
- `RecognizeImage(Bitmap image, string language)` - распознает текст установленного языка на данном изображении и возвращает его в виде строки. Если текст не найден возвращает null.
#### TranslationService.cs
Сервис для перевода текста с помощью Google Translate.

Методы:
- `TranslateTextAsync(string text, string language)` - асинхронный метод, отправляющий запрос перевода в Google Translate с помощью библиотеки GTranslate. Возвращает переведенный текст.
### ViewModel/
#### MainWindowViewModel.cs
Модель вида для главного окна приложения.

Свойства:
- `SourceLanguages` - доступные языки для распознавания.
- `TargetLanguages` - доступные языки для перевода.
- `SelectedSourceLanguage` - выбранный язык для распознавания.
- `SelectedTargetLanguage` - выбранный язык для перевода.

Методы:
- `TranslateFromBitmapAsync(Bitmap bitmap)` - асинхронный метод, выполняющий все нужные процедуры и возвращающий перевод в виде строки, либо возвращает null если какая-либо из процедур не смогла выполниться.

### View/
#### HotkeyDialog.xaml/HotkeyDialog.xaml.cs
Диалоговое окно для установки сочетания клавиш/горячей клавиши.
#### MainWindow.xaml/MainWindow.xaml.cs
Основное окно программы, предназначенное для выставления настроек.
#### ScreenCaptureOverlay.xaml/ScreenCaptureOverlay.xaml.cs
Оверлей для выделения области перевода на экране.
#### TranslationWindow.xaml/TranslationWindow.xaml.cs
Простое окно, содержащее переведенный текст.
## Особенности
- WPF - фреймворк для создания desktop приложений на Windows
- Tesseract OCR - библиотека для распознавания текста на изображении
- Gtranslate - библиотека для подключения к API переводчиков